<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="header.js"></script>
  <link rel="stylesheet" href="style.css">
  <title>Vocab</title>
  <link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>
  <style>
    /* âœ… Darker header row */
    .gridjs-thead .gridjs-th {
      background-color: #004466 !important;
      color: #ffffff !important;
      font-weight: bold;
      text-align: center;
    }

    /* âœ… Alternating row colors */
    .gridjs-tbody .gridjs-tr:nth-child(odd) .gridjs-td {
      background-color: #ffffff !important;
    }
    .gridjs-tbody .gridjs-tr:nth-child(even) .gridjs-td {
      background-color: #e6f3ff !important;
    }

    /* âœ… Top buttons */
    #randomBtn, #resetBtn {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 4px 8px;
      margin: 4px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }
    #randomBtn:hover, #resetBtn:hover {
      background-color: #45a049;
    }

    /* âœ… Show button in table */
    .show-btn {
      background-color: #008CBA;
      color: white;
      border: none;
      padding: 2px 6px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: 0.2s;
    }
    .show-btn:hover {
      background-color: #0073a4;
    }

    /* âœ… Fade-in + highlight animation */
    .fade-in {
      opacity: 0;
      background-color: #fff7a8;
      border-radius: 3px;
      padding: 2px 4px;
      transition: opacity 0.5s ease-in, background-color 1s ease-out;
    }
    .fade-in.visible {
      opacity: 1;
    }
    .fade-in.dim {
      background-color: transparent;
    }
  </style>
</head>
<body>
  <header3-component></header3-component>

  <div class="game-container">
    <h3 style="text-align:center;">Vocab</h3>
    <div style="text-align:center; margin-bottom: 10px;">
      <button id="randomBtn">Rawak 10</button>
      <button id="resetBtn">Reset</button>
    </div>

    <div id="loading">Sedang memuat naik data...</div>
    <div id="grid"></div>
  </div>

  <script>
    const sheetUrl = "https://script.google.com/macros/s/AKfycbwH-AFyG33Hfgw-2-fX0LSXvVtHHwTlzDPj-YhlUSenDn8Xd-hUEbD5EXKkK6Te15Tj/exec";

    let originalRows = [];
    let headers = [];
    let grid;

    function renderTable(rows, withPagination = true) {
      if (grid) grid.destroy();

      // âœ… Render columns with HTML support (for our button)
      const columns = headers.map(header => ({
        name: header,
        formatter: cell => gridjs.html(cell)
      }));

      grid = new gridjs.Grid({
        columns: columns,
        data: rows,
        search: withPagination ? { enabled: true } : false,
        sort: true,
        pagination: withPagination ? { enabled: true, limit: 10 } : false,
        language: {
          search: { placeholder: 'Cari perkataan...' }
        }
      }).render(document.getElementById('grid'));
    }

    fetch(sheetUrl)
      .then(response => response.json())
      .then(data => {
        document.getElementById('loading').style.display = 'none';

        if (!data.length) {
          document.getElementById('loading').textContent = 'No data available.';
          return;
        }

        headers = Object.keys(data[0]);
        originalRows = data.map(row => Object.values(row));

        // ðŸ”  Sort alphabetically by first column
        originalRows.sort((a, b) => {
          const valA = String(a[0] || "").toLowerCase();
          const valB = String(b[0] || "").toLowerCase();
          return valA.localeCompare(valB);
        });

        renderTable(originalRows, true);
      })
      .catch(err => {
        console.error('Error fetching data:', err);
        document.getElementById('loading').textContent = 'Failed to load data.';
      });

    // âœ… Random 10 button
    document.getElementById('randomBtn').addEventListener('click', () => {
      if (!originalRows.length) return;

      const shuffled = [...originalRows].sort(() => 0.5 - Math.random());
      const random10 = shuffled.slice(0, 10);

      // Hide one column (randomly)
      const hiddenRows = random10.map(row => {
        const hiddenIndex = Math.random() < 0.5 ? 0 : 1;
        const hiddenWord = row[hiddenIndex]
          .replace(/'/g, "\\'")
          .replace(/"/g, '&quot;'); // escape quotes

        const showButton = `
          <button class="show-btn" onclick="revealWord(this, '${hiddenWord}')">Show</button>
        `;

        const newRow = [...row];
        newRow[hiddenIndex] = showButton;
        return newRow;
      });

      renderTable(hiddenRows, false);
    });

    // âœ… Reset button
    document.getElementById('resetBtn').addEventListener('click', () => {
      if (!originalRows.length) return;
      renderTable(originalRows, true);
    });

    // âœ… Reveal + highlight fade animation
    window.revealWord = (btn, word) => {
      const span = document.createElement('span');
      span.textContent = word;
      span.className = 'fade-in';
      btn.replaceWith(span);

      // Trigger fade-in
      requestAnimationFrame(() => span.classList.add('visible'));

      // After 1s, remove highlight color
      setTimeout(() => span.classList.add('dim'), 1200);
    };
  </script>
</body>
</html>
